MetaCat Concepts
================

MetaCat is a general purpose metadata catalog. It has 4 major functions:

1. Store metadata associated with a *file*

2. Provide a mechanism to retrieve the metadata associated with a file

3. Efficiently query the metadata database to find files matching the list of crieria expressed in terms of file metadata

4. Provide a mechanism to seamlessly and efficiently integrate metadata stored in external sources to the query results and use it select files based on their metadata values


File
----
MetaCat is a purely metadata database. Replica management is outside of MetaCat scope. That is why in MetaCat, *file* is
rather abstract object. MetaCat "file" is anything wich has the following attributes:

* Unique text *file id*
* Unique *Name* within a *Namespace*
* *Metadata* dictionary
* File *provenance* information - list of file *parents* and *clildren*

File id can be either specified by the user at the time of the file declaration or auto-generated using random UUID by MetaCat.
If specified, the file id must be unique for the MetaCat instance.

File name has to be unique withing the namespace. It also can be auto-generated by MetaCat at the file declaration time. 
To have the name auto-generated, the user specifies the template for the file name.
The following values in various formats can be used as part of the pattern:

* Randomly generated UUID
* Current timestamp
* File id

MetaCat also stores the following file attributes:

* File creator username
* Declaration time
* File size
* One or more checksums

These attributes are not used by MetaCat itself. The declaration timestamp and the creation time are recorded to the database automatically at the
time of the file declaration. Depending on the use case, file size and checksums do not necessarily have to have some meaningful values.

File can be a memeber of one or more *Datasets*

Dataset
-------
In MetaCat, *Dataset* is a relatively static collection of files. "Relatively static" means that files are added to and removed from
a dataset explicitly. There is no such thing as a "dynamic" dataset, which automatically contains files matching certain criteria.
MetaCat Dataset has the following attributes:

* Unique *Name* within a *Namespace*
* *Metadata* dictionary

A Dataset can have zero or more subsets. MetaCat enforces non-circular relationship between data datasets, i.e. it is impossible
to add a dataset as its own direct ot indirect subset.

Dataset also has the following attributes, not used by MetaCat:

* Creator username
* Creation time

Dataset can define metadata restrictions. They can be used to enforce certain requirements for files added to the dataset. The rules can be defined to:

* Require certain metadata fields to be present in the file metadata
* Define acceptable ranges, enumeration or patterns for parameter values

Parameter Categories
--------------------
Metadata parameters are grouped into categories. Categories may have subcategories. Each metadata parameter name must include st least one dot.
Parameter categoty is the portion of the parameter name before the last dot and parameter name within the category is the part of the name after
the last dot. For example, if the full parameter name is ``detector.beam.status``, then the category name is ``detector.beam`` and the parameter name
is ``status``.

The purpose of the parameter category is to allow adding *metadata constraints* for the parameters in the category. Each constraint defined in terms of:

* The name of the parameter
* Parameter type (any, int, string, float, dictionary, list, list of ints, etc.)
* Allowed parameter values (range, enumeration, pattern)

The category can be either *restricted* or not. If restricted, the category may not contain any parameters other than those listed in the category constraints.

Ownership
---------
MetaCat has the notion of object ownership. Namespaces and Parameter Categories can be owned either by an individual user or by a *role* (group of users).
The owner of a namespace automatically owns all the datasets and the files in the namespace. The following operations can only be performed by the object owner:

* Declaring a file to a dataset
* Creating a dataset in a namespace
* Adding a dataset to another dataset
* Adding a file to a dataset
* Creating parameter subcategories
* Modifying metadata constraints in the category

Query
-----

MetaCat query is an algorithm to select files based on the set of criteria defined by the user. Result of a query execution is a *file set*.
File set is an unordered collection of files, which match given set of criteria at the time when the query is executed.
Because the contents of the database is dynamic and can change at any time, the same query is *not* guaranteed to always return the same results 
next time it is executed.

Currently, MetaCat does not have a mechanism to specify the order of the resulting file set. Therefore, even if the set of files returned by the 
query is the same, MetaCat does not guarantee that they are returned in the same order.

MetaCat queries are written in Metadata Query Language (MQL). Fundamental concept behind MQL is that it provides a mechanism to
build a complicated query from simpler queries. The file sets produced by simple queries are transformed into results of more complicated
queries as the query is executed.

Most of MQL queries are translated internally into SQL. This allows most of the queries to be executed by the database engine, which is supposed
to be able to do that efficiently. The only exception is when an *external data filter* is used in the query.
In this case, MetaCat translates portions of the query into SQL as much as possible and the rest of the query.

Currentyly, queries do not require any authorization