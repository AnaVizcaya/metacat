{% extends "base.html" %}

{% block headline %}Datasets{% endblock %}

{% block content %}

<p>
<a href="./create_dataset">create</a>
</p>

<!-- {{authenticated}} -->

<table class="data">
	<tr>
		<th>Dataset</th>
        {% if logged_in %}<th>Creator</th>{% endif %}
        <th>Created</th>
		<th>Frozen</th>
		<th>Monotonic</th>
		<th>Files</th>
        <th>Children</th>
        <th>Subsets</th>
        <th>Parents</th>
        <th>Ancestors</th>
        {% if logged_in %}<th>Delete</th>{% endif %}
	</tr>
	{% for ds in datasets %}
		<tr>
            <td><a href="./dataset?namespace={{ds.Namespace}}&name={{ds.Name}}">{{ds.Namespace}}:{{ds.Name}}</a></td>
            {% if logged_in %}
                <td>{% if ds.Creator %}<a href="./user?username={{ds.Creator}}">{{ds.Creator}}</a>{% endif %}</td>
            {% endif %}
            <td>{% if ds.CreatedTimestamp %}{{ds.CreatedTimestamp|as_dt_local}}{% endif %}</td>
            <td>{{'frozen' if ds.Frozen}}</td>
            <td>{{'monotonic' if ds.Monotonic}}</td>
            <td id="count:{{ds.Namespace}}:{{ds.Name}}" class="right"></td>
            <td>
                {% for child in ds.GUI_Children %}
                    <a href="./dataset?namespace={{child.Namespace}}&name={{child.Name}}">{{child.Namespace}}:{{child.Name}}</a><br/>
                {% endfor %}
            </td>
            <td>{{ds.subset_count()}}</td>
            <td>
                {% for parent in ds.GUI_Parents %}
                    <a href="./dataset?namespace={{parent.Namespace}}&name={{parent.Name}}">{{parent.Namespace}}:{{parent.Name}}</a><br/>
                {% endfor %}
            </td>
            <td>{{ds.ancestor_count()}}</td>
            {% if logged_in %}
                <td>
                    {% if not ds.GUI_Authorized %}
                        <span style="color:gray">unauthorized</span>
                    {% elif ds.GUI_Children|length > 0 %}
                        <span style="color:gray">not empty</span>
                    {% else %}
                        <a href="./delete_dataset?namespace={{ds.Namespace}}&name={{ds.Name}}">delete</a>
                    {% endif %}
                </td>
            {% endif %}

            <script>
		        var out = document.getElementById("count:{{ds.Namespace}}:{{ds.Name}}");
		        out.data_received = function(data, param) { this.innerHTML = "" + data.file_count; };
                HTTPRequest("{{GLOBAL_AppTopPath}}/data/dataset_count/{{ds.Namespace}}:{{ds.Name}}", 
			        out, null, "json");
            </script>

        </tr>
	{% endfor %}
</table>


{% endblock %}
